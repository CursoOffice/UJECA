<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pasarela de Pago | Congreso 2026</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
 --rojo:#d62828;
 --rojo-oscuro:#9d0208;
 --sombra:0 20px 60px rgba(0,0,0,.15);
}

body{
min-height:100vh;
position:relative;
font-family:'Poppins',sans-serif;
margin:0;
}

body::before{
content:"";
position:fixed;
inset:0;
background:url("img/banner.jpg") center/cover no-repeat;
filter:blur(12px) brightness(.7);
z-index:-2;
}

body::after{
content:"";
position:fixed;
inset:0;
background:linear-gradient(135deg,#ffffffcc,#f1f3f5ee);
z-index:-1;
}

header{
background:white;
padding:18px 30px;
display:flex;
justify-content:space-between;
align-items:center;
box-shadow:0 4px 20px rgba(0,0,0,.08);
border-bottom:4px solid var(--rojo);
}

header h1{
font-size:1.25rem;
font-weight:700;
color:var(--rojo);
margin:0;
}

nav a{
text-decoration:none;
margin-left:10px;
padding:10px 18px;
border-radius:10px;
background:#e9ecef;
color:#333;
font-weight:600;
}

.panel{
max-width:950px;
margin:60px auto;
background:white;
padding:45px;
border-radius:22px;
box-shadow:var(--sombra);
}

h2{
color:var(--rojo);
margin-bottom:25px;
text-align:center;
}

.buscar{
display:flex;
gap:12px;
margin-bottom:30px;
}

input{
padding:14px;
border-radius:12px;
border:1px solid #ced4da;
width:100%;
font-size:1rem;
}

input:focus{
outline:none;
border-color:var(--rojo);
box-shadow:0 0 0 3px rgba(214,40,40,.15);
}

button{
background:linear-gradient(135deg,var(--rojo),var(--rojo-oscuro));
color:white;
border:none;
padding:14px 24px;
border-radius:12px;
cursor:pointer;
font-weight:600;
}

.factura{
display:none;
margin-top:40px;
border-radius:18px;
background:#fff;
padding:35px;
border:2px dashed #e9ecef;
position:relative;
}

.factura::before{
content:"CONGRESO 2026";
position:absolute;
top:50%;
left:50%;
transform:translate(-50%,-50%) rotate(-25deg);
font-size:90px;
color:#00000008;
font-weight:800;
pointer-events:none;
}

.grid{
display:grid;
grid-template-columns:1fr 1fr;
gap:18px;
margin-bottom:25px;
}

.grid div{
background:#f8f9fa;
padding:12px 15px;
border-radius:10px;
font-size:.95rem;
}

.total{
background:linear-gradient(135deg,#fff5f5,#ffe3e3);
padding:25px;
border-radius:15px;
margin-top:20px;
border-left:6px solid var(--rojo);
}

#saldo{
margin-top:15px;
font-size:1.3rem;
font-weight:700;
}

.estado{
margin-top:15px;
padding:10px;
text-align:center;
font-weight:700;
border-radius:10px;
}

.pagado{background:#d8f3dc;color:#2d6a4f}
.pendiente{background:#ffe3e3;color:#9d0208}

.print{
margin-top:25px;
width:100%;
background:#2b9348;
font-size:1.1rem;
}

@media print{
button,header,.buscar{display:none}
body::before,body::after{display:none}
.panel{box-shadow:none;margin:0;padding:0}
.factura{border:none}
}
</style>
</head>

<body>

<header>
<h1>Generar Factura - Congreso 2026</h1>
<nav>
<a href="index.html">Inicio</a>
<a href="Basedatos.html">Inscritos</a>
</nav>
</header>

<div class="panel">

<h2>Buscar participante</h2>

<div class="buscar">
<input id="cedula" placeholder="Ingrese número de documento">
<button onclick="buscar()">Buscar</button>
</div>

<div id="factura" class="factura">

<h2>Recibo de Pago</h2>

<div class="grid">
<div><b>Nombre:</b> <span id="nombre"></span></div>
<div><b>Documento:</b> <span id="doc"></span></div>
<div><b>Iglesia:</b> <span id="iglesia"></span></div>
<div><b>Ciudad:</b> <span id="ciudad"></span></div>
<div><b>Código:</b> <span id="codigo"></span></div>
<div><b>Fecha:</b> <span id="fecha"></span></div>
</div>

<div class="total">
<p>Valor inscripción: <b>$550.000</b></p>
<p id="descuento"></p>

<br>
<label>Abono realizado:</label>
<input id="abono" type="number" placeholder="Valor pagado" oninput="calcular()">

<h3 id="saldo"></h3>
<div id="estado" class="estado"></div>
</div>

<button class="print" onclick="window.print()">Imprimir / Guardar PDF</button>

</div>
</div>

<script>

const API="https://script.google.com/macros/s/AKfycbwKgXBGwoIroq2DnTTXA5i_SyN_9urz-w8RLVVtLZLBmzwnKTWOD07tyuIMivTzQAPL/exec";

let BD=[];
let cargada=false;
let precio=550000;
let descuento=0;

/* ========= FORMATO DINERO ========= */
function money(n){
return "$"+Number(n).toLocaleString("es-CO");
}

/* ========= CARGAR BASE ========= */
async function cargar(){
try{
let r=await fetch(API);
let json=await r.json();

BD = Array.isArray(json)?json:Object.values(json);

cargada=true;
console.log("Base cargada:",BD.length,"registros");

}catch(e){
alert("No se pudo conectar con la base de datos");
}
}
cargar();

/* ========= BUSCAR ========= */
function buscar(){

if(!cargada){
alert("La base aún está cargando, intenta nuevamente en 2 segundos");
return;
}

let doc=document.getElementById("cedula").value.trim();
if(!doc) return alert("Ingrese documento");

let persona = BD.find(row => 
String(row.Documento || row.documento || row.cedula || "")
.trim() === doc
);

if(!persona){
alert("Participante no encontrado");
return;
}

/* DATOS EXACTOS POR COLUMNA */
let nombre = persona.Nombre || persona.nombre || "No registrado";
let iglesia = persona.Iglesia || persona.iglesia || "No especificada";
let ciudad = persona.Municipio || persona.Ciudad || persona.ciudad || "";
let codigo = persona.Codigo || persona.codigo || persona.ID || "";

/* DESCUENTO SOLO SI EXISTE COLUMNA PUESTO */
let posicion = Number(persona.Puesto || persona.puesto || 9999);
descuento = posicion<=40?50000:0;

/* PINTAR */
document.getElementById("nombre").innerText=nombre;
document.getElementById("doc").innerText=doc;
document.getElementById("iglesia").innerText=iglesia;
document.getElementById("ciudad").innerText=ciudad;
document.getElementById("codigo").innerText=codigo;
document.getElementById("fecha").innerText=new Date().toLocaleDateString("es-CO");

document.getElementById("descuento").innerText=
descuento>0?"Descuento aplicado: -"+money(descuento):"Sin descuento";

document.getElementById("factura").style.display="block";

calcular();
}

/* ========= CALCULAR SALDO ========= */
function calcular(){

let abono=Number(document.getElementById("abono").value)||0;
let total=precio-descuento;
let saldo=total-abono;
if(saldo<0) saldo=0;

document.getElementById("saldo").innerText="Saldo pendiente: "+money(saldo);

let estado=document.getElementById("estado");

if(saldo===0){
estado.innerText="✔ INSCRIPCIÓN PAGADA";
estado.className="estado pagado";
}else{
estado.innerText="✖ PAGO PENDIENTE";
estado.className="estado pendiente";
}

}

</script>


</body>
</html>
