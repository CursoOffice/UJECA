<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inscritos Congreso UJEC 2026</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="apple-touch-icon" href="img/logo.png">
<style>
:root{
 --rojo:#d62828;
 --rojo-oscuro:#9d0208;
 --gris:#f8f9fa;
 --texto:#343a40;
 --borde:#e9ecef;
 --sombra:0 15px 40px rgba(0,0,0,.08);
}

*{
box-sizing:border-box;
margin:0;
padding:0;
font-family:'Poppins',sans-serif
}

body{
background:linear-gradient(135deg,#f8f9fa,#eef1f4);
color:var(--texto);
min-height:100vh;
}

/* HEADER */
header{
background:white;
padding:18px 30px;
display:flex;
flex-wrap:wrap;
justify-content:space-between;
align-items:center;
box-shadow:0 4px 15px rgba(0,0,0,.05);
gap:15px;
position:sticky;
top:0;
z-index:100;
}

.header-left{
display:flex;
align-items:center;
gap:15px;
}

header img{
height:55px;
}

header h1{
font-size:1.2rem;
font-weight:600;
}

.header-buttons a{
text-decoration:none;
padding:10px 18px;
border-radius:10px;
font-weight:600;
margin-left:5px;
transition:all .3s ease;
font-size:14px;
}

.home{
background:#e9ecef;
color:#333;
}

.home:hover{
background:#dee2e6;
}

.inscritos{
background:var(--rojo);
color:white;
}

.inscritos:hover{
background:var(--rojo-oscuro);
transform:translateY(-2px);
}

/* PANEL */
.panel{
max-width:1100px;
margin:60px auto;
background:white;
padding:45px;
border-radius:20px;
box-shadow:var(--sombra);
animation:fadeIn .6s ease;
}

@keyframes fadeIn{
from{opacity:0;transform:translateY(15px)}
to{opacity:1;transform:translateY(0)}
}

.panel h2{
margin-bottom:30px;
color:var(--rojo);
font-size:1.8rem;
font-weight:700;
}

/* BUSCADOR */
.search{
display:flex;
justify-content:space-between;
align-items:center;
flex-wrap:wrap;
gap:20px;
margin-bottom:35px;
padding-bottom:20px;
border-bottom:1px solid var(--borde);
}

.search input{
padding:14px 18px;
border-radius:12px;
border:1px solid #ced4da;
width:280px;
font-size:14px;
transition:.3s;
}

.search input:focus{
outline:none;
border-color:var(--rojo);
box-shadow:0 0 0 3px rgba(214,40,40,.1);
}

.count{
font-weight:600;
color:var(--rojo);
font-size:1rem;
}

/* TABLA */
.table-container{
width:100%;
overflow-x:auto;
border-radius:14px;
}

table{
width:100%;
min-width:1000px;
border-collapse:separate;
border-spacing:0;
font-size:13px;
}

th{
background:var(--rojo);
color:white;
padding:14px;
text-align:left;
white-space:nowrap;
font-size:12px;
letter-spacing:.5px;
position:sticky;
top:0;
}

td{
padding:13px 14px;
border-bottom:1px solid #f1f1f1;
white-space:nowrap;
}


tr:hover{
background:#fff5f5;
}

/* BOTÓN */
.btn-download{
background:var(--rojo);
color:white;
border:none;
padding:11px 18px;
border-radius:10px;
font-weight:600;
cursor:pointer;
transition:.3s;
display:none;
}

.btn-download:hover{
background:var(--rojo-oscuro);
transform:translateY(-2px);
}

/* LOADING */
.loading{
text-align:center;
padding:50px;
font-weight:600;
color:var(--rojo);
font-size:16px;

}

@keyframes pulse{
from{opacity:.5}
to{opacity:1}
}

/* FOOTER */
footer{
text-align:center;
padding:25px;
margin-top:40px;
color:#777;
font-size:13px;
}

/* RESPONSIVE */
@media(max-width:768px){

.panel{
padding:25px;
margin:30px 15px;
}

header{
padding:15px;
}

header h1{
font-size:1rem;
text-align:center;
}

.search{
flex-direction:column;
align-items:flex-start;
}

.search input{
width:100%;
}

}
</style>

</head>

<body>

<header>
  <div class="header-left">
    <img src="img/logo.png">
    <h1>Inscritos congreso  circuito 2 zona 6</h1>
  </div>

  <div class="header-buttons">
    <a href="index.html" class="home">Home</a>
    <a href="formulario.html" class="inscritos">Inscribirme</a>
  </div>
</header>

<div class="panel">

  <h2>Listado Oficial de Inscritos</h2>

  <div class="search">
    <input type="text" id="busqueda" placeholder="Buscar por nombre, iglesia, ciudad...">
    <div class="count" id="contador">Cargando...</div>
    <button id="descargar" class="btn-download">Descargar Excel</button>

  </div>

  <div id="tabla" class="loading">Cargando inscritos...</div>

</div>

<footer>
© 2026 - Unión Juvenil Evangélica del Caribe | Circuito 2 Zona 6
</footer>

<script>
const API = "https://script.google.com/macros/s/AKfycbyTXIRGby3Js7ySQ9Vpuh-wO2VBtDGS2oHV6BqQSBhqQB3aHR5ltwVjd6w3D289ZPiS/exec";

let datosGlobal = [];

function renderTabla(data){
    if(!data || data.length===0){
        document.getElementById("tabla").innerHTML="No hay resultados";
        document.getElementById("contador").innerText="0 inscritos";
        return;
    }

    let headers = Object.keys(data[0]);

    let html='<div class="table-container"><table><thead><tr>';
    headers.forEach(h=> html+=`<th>${h}</th>`);
    html+='</tr></thead><tbody>';

    data.forEach(row=>{
        html+="<tr>";
        headers.forEach(h=> html+=`<td>${row[h] ?? ""}</td>`);
        html+="</tr>";
    });

    html+="</tbody></table></div>";

    document.getElementById("tabla").innerHTML=html;
    document.getElementById("contador").innerText=data.length+" inscritos";
    const btnDescargar = document.getElementById("descargar");
    if(btnDescargar){
        btnDescargar.style.display="block";
    }
}

function cargarDatos(data){
    datosGlobal=data;
    renderTabla(data);
}

document.getElementById("busqueda").addEventListener("input",e=>{
    const texto=e.target.value.toLowerCase();

    const filtrados=datosGlobal.filter(row=>
        Object.values(row).some(val=>
            String(val).toLowerCase().includes(texto)
        )
    );

    renderTabla(filtrados);
});

const script=document.createElement("script");
script.src=API+"?callback=cargarDatos";
document.body.appendChild(script);
document.getElementById("descargar").addEventListener("click", function(){

    if(!datosGlobal || datosGlobal.length === 0){
        alert("No hay datos para descargar");
        return;
    }

    // Detectar lo que está actualmente visible (filtrado)
    const texto = document.getElementById("busqueda").value.toLowerCase();

    const datosFiltrados = datosGlobal.filter(row =>
        Object.values(row).some(val =>
            String(val).toLowerCase().includes(texto)
        )
    );

    if(datosFiltrados.length === 0){
        alert("No hay resultados para descargar");
        return;
    }

    const headers = Object.keys(datosFiltrados[0]);

    let csv = headers.join(",") + "\n";

    datosFiltrados.forEach(row => {
        let fila = headers.map(h => `"${row[h] ?? ""}"`);
        csv += fila.join(",") + "\n";
    });

    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const link = document.createElement("a");

    link.href = URL.createObjectURL(blob);
    link.download = "inscritos_congreso_2026.csv";
    link.click();
});

</script>

</body>
</html>
